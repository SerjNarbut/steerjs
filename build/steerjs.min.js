/**
 * @license
 * steerjs - v0.1.1
 * Copyright (c) 2014, Serj Narbut
 *
 * Compiled: 2014-06-18
 *
 * steerjs is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(){"use strict";var a=this,b=b||{};b.version="v0.1.0",b.debug=!1,b.servicePrefix="Service",b.Random=function(a,b){return Math.random()*(b-a)+a},b.RandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},b.extendClass=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype},b.isFunction=function(a){return"function"==typeof a},b.isObject=function(a){return"object"==typeof a},b.isString=function(a){return"string"==typeof a},b.isArray=function(a){return"[object Array]"==toString.call(a)},b.extend=function(){for(var a=arguments[0],b=function(a,b){for(var c in b)a[c]=b[c];return a},c=1;c<arguments.length;c++)a=b(a,arguments[c]);return a},b.contains=function(a,b){var c=a.toLowerCase(),d=b.toLowerCase(),e=c.indexOf(d);return-1!=e},b.Injector=function(){this.dependencies={},this.services={};var a=this;this.servicesInjector=b.createInnerInjector(this.services,function(a){throw new Error("Cant inject "+a)}),this.dependencyInjector=b.createInnerInjector(this.dependencies,function(c){var d=a.servicesInjector.get(c);return b.isArray(d)||b.isFunction(d)?a.dependencyInjector.resolve(d):d})},b.Injector.prototype=b.Injector,b.Injector.prototype.register=function(a,b){this.dependencies[a]=b},b.Injector.prototype.registerService=function(a,b){this.services[a]=b},b.Injector.prototype.registerConstant=function(a,b){if(this.services.hasOwnProperty(a))throw new Error("Constant "+a+" already defined");this.services[a]=b},b.Injector.prototype.unregister=function(a){this.dependencies.hasOwnProperty(a)&&delete this.dependencies[a],this.services.hasOwnProperty(a)&&delete this.services[a],this.services.hasOwnProperty(a+b.servicePrefix)&&delete this.services[a+b.servicePrefix]},b.Injector.prototype.canResolve=function(a){return this.dependencies.hasOwnProperty(a)||this.services.hasOwnProperty(a)||this.services.hasOwnProperty(a+b.servicePrefix)},b.Injector.prototype.get=function(a){if(b.debug&&console.log("Resolving dependency "+a),this.canResolve(a)){var c=this.dependencies[a];return void 0==c&&(c=this.services[a]),void 0==c&&(c=this.services[a+"Service"]),c}return null},b.Injector.prototype.clear=function(){delete this.dependencies,this.dependencies={}},b.Injector.prototype.resolve=function(a){var c={};if(b.isArray(a))for(var d=0;d<a.length;d++)b.isObject(a[d])&&(c=a[d]);return this.dependencyInjector.resolve(a,c||{})},b.Injector.prototype.extend=function(a){this.dependencies=b.extend(this.dependencies,a.dependencies),this.services=b.extend(this.services,a.services)},b.getDependencies=function(a){var c=[];if(b.isFunction(a))if(void 0==a.$inject){var d=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,e=a.toString().match(d)[1].replace(/ /g,"").split(",");for(f=0;f<e.length;f++)""!=e[f]&&c.push(e[f]);a.$inject=c}else c=a.$inject;else if(b.isArray(a)){for(var f=0;f<a.length;f++)b.isString(a[f])&&c.push(a[f]);a.$inject=c}return c},b.createInnerInjector=function(a,c){function d(d){if(a.hasOwnProperty(d))return a[d];if(a.hasOwnProperty(d+b.servicePrefix))return a[d+b.servicePrefix];try{return a[d]=c(d),a[d]}catch(e){throw delete a[d],e}}function e(c,e){for(var f=[],g=b.getDependencies(c),h=0;h<g.length;h++)f.push(a.hasOwnProperty(g[h])?a[g[h]]:d(g[h]));return b.isArray(c)&&(c=c[c.length-1]),c.apply(e,f)}return{get:d,resolve:e}},b.seek=function(a,c,d){var e=b.Vector.minus(c,a.location);e.normalize(),e.multiScalar(a.maxSpeed);var f=b.Vector.minus(e,a.velocity);return f.multiScalar(d),f},b.seek.$inject=["unit","goal","alfa"],b.flee=function(a,c,d){var e=b.seek(a,c,d);return e.multiScalar(-1),e},b.flee.$inject=["unit","goal","alfa"],b.pursuit=function(a,c,d){var e=b.Vector.distance(a.location,c.location)/a.maxSpeed,f=b.Vector.add(c.location,b.Vector.multipleScalar(c.velocity,e));return b.seek(a,f,d)},b.pursuit.$inject=["unit","leader","alfa"],b.evade=function(a,c,d){var e=b.Vector.distance(a.location,c.location)/a.maxSpeed,f=b.Vector.add(c.location,b.Vector.multipleScalar(c.velocity,e));return b.flee(a,f,d)},b.evade.$inject=["unit","leader","alfa"],b.arrival=function(a,c,d,e){if(e>1)throw new Error("For arrival algo alfa must be less or equals than 1, but current alfa is "+e);var f=b.Vector.minus(c,a.location),g=f.length();d>g?(f.normalize(),f.multiScalar(a.maxSpeed),f.multiScalar(g/d)):(f.normalize(),f.multiScalar(a.maxSpeed));var h=b.Vector.minus(f,a.velocity);return h.multiScalar(e),h},b.arrival.$inject=["unit","goal","closestsRadius","alfa"],b.separate=function(a,c,d,e){var f=b.Vector.zero(),g=0;for(var h in c)if(a!=c[h]){var i=b.Vector.distance(a.location,c[h].location);d>=i&&(f.add(c[h].location.between(a.location)),i>0&&f.divScalar(i),g++)}return g>0&&(f.divScalar(g),f.multiScalar(-1),f.normalize(),f.multiScalar(e)),f},b.separate.$inject=["unit","units","separateRadius","alfa"],b.align=function(a,c,d,e){var f=b.Vector.zero(),g=0;for(var h in c)if(c[h]!=a){var i=b.Vector.distance(a.location,c[h].location);i>0&&d>=i&&(f.add(c[h].velocity),g++)}return g>0&&(f.divScalar(g),f.normalize(),f.multiScalar(e)),f},b.align.$inject=["unit","units","alignRadius","alfa"],b.cohesion=function(a,c,d,e){var f=b.Vector.zero(),g=0;for(var h in c)if(c[h]!=a){var i=b.Vector.distance(a.location,c[h].location);i>0&&d>=i&&(f.add(c[h].location),g++)}return g>0&&(f.divScalar(g),f.minus(a.location),f.normalize(),f.multiScalar(e)),f},b.cohesion.$inject=["unit","units","cohesionRadius","alfa"],b.flocking=function(a,c,d,e,f,g,h,i,j){var k=b.Vector.zero(),l=b.Vector.zero(),m=b.Vector.zero(),n=0,o=0,p=0;for(var q in c)if(c[q]!=a){var r=b.Vector.distance(a.location,c[q].location);separateRadius>=r&&(k.add(c[q].location.between(a.location)),r>0&&s.divScalar(r),n++),r>0&&f>=r&&(m.add(c[q].velocity),p++),r>0&&cohesionRadius>=r&&(l.add(c[q].location),o++)}n>0&&(k.divScalar(n),k.multiScalar(-1),k.normalize(),k.multiScalar(g)),p>0&&(m.divScalar(p),m.normalize(),m.multiScalar(i)),o>0&&(l.divScalar(o),l.minus(a.location),l.normalize(),l.multiScalar(h));var s=b.Vector.add(k,b.Vector.add(l,m));return s.multiScalar(j),s},b.flocking.$inject=["unit","units","sepRadius","cohRadius","alignRadius","alfaSep","alfaCoh","alfaAlign","alfa"],b.leaderFollowing=function(a,c,d,e,f,g,h,i){function j(d){return b.Vector.distance(d,a.location)<=f||b.Vector.distance(c.location,a.location)<=f}var k=b.separate(a,d,g,h),l=c.velocity.clone();l.normalize(),l.multiScalar(e);var m=c.location.clone().add(l);l.multiScalar(-1);var n=c.location.clone().add(l);return j(m)&&k.add(b.evade(a,c.location,1)),k.add(b.arrival(a,n,e,1)),k.add(b.separate(a,d,g,h)),k.multiScalar(i),k},b.leaderFollowing.$inject=["unit","leader","units","leaderDistance","sightRadius","sepRadius","alfaSep","alfa"],b.pathFollowing=function(a,c,d,e){if(null!=c){var f=c[a.wayPointIndex];return b.Vector.distance(a.location,f)<d&&(a.wayPointIndex++,a.wayPointIndex>radius.length&&(a.wayPointIndex=null)),null!=a.wayPointIndex?(f=c[a.wayPointIndex],b.seek(a,f,e)):b.Vector.zero()}return b.Vector.zero()},b.pathFollowing.$inject=["unit","path","radius","alfa"],b.collisionAvoidance=function(a,c,d,e){function f(a,c,d){return b.Vector.distance(d.center,a)<=d.radius||b.Vector.distance(d.center,c)<=d.radius}function g(){for(var d=null,e=c.length,g=0;e>g;g++){var h=c[g],k=f(i,j,h);k&&(null==d||b.Vector.distance(a.location,h)<b.Vector.distance(a.loction,d))&&(d=h)}return h}var h=a.velocity.clone();h.normalize(),h.multiScalar(d*a.velocity.length()/a.maxSpeed);var i=a.location.clone();i.add(h),h.multiScalar(.5);var j=a.location.clone();j.add(h);var k=(b.Vector.zero(),g());if(null!=k){var l=b.Vector.minus(i,k.center);return l.normalize(),l.multi(e),l}return b.Vector.zero()},b.Vector=function(a,b){this.x=a||0,this.y=b||0},b.Vector.prototype.constructor=b.Vector,b.Vector.prototype.clone=function(){return new b.Vector(this.x,this.y)},b.Vector.prototype.add=function(a){this.x+=a.x,this.y+=a.y},b.Vector.prototype.minus=function(a){this.x-=a.x,this.y-=a.y},b.Vector.prototype.multiScalar=function(a){this.x*=a,this.y*=a},b.Vector.prototype.divScalar=function(a){this.x/=a,this.y/=a},b.Vector.prototype.multiple=function(a){return this.x*a.x+this.y*a.y},b.Vector.prototype.between=function(a){return b.Vector.minus(this,a)},b.Vector.prototype.length=function(){return Math.sqrt(this.lengthNonSqrt())},b.Vector.prototype.lengthNonSqrt=function(){return this.x*this.x+this.y*this.y},b.Vector.prototype.normalize=function(){var a=this.length();0!=a&&(this.x/=a,this.y/=a)},b.Vector.prototype.limit=function(a){var b=this.length();b>a&&0!=b&&(this.x/=b,this.y/=b,this.multiScalar(a))},b.Vector.getProjectionOn=function(a){return a.normalize(),a.multiScalar(b.Vector.multiple(this,a)),a},b.Vector.prototype.equals=function(a){return this.x==a.x&&this.y==a.y},b.Vector.add=function(a,c){return new b.Vector(a.x+c.x,a.y+c.y)},b.Vector.minus=function(a,c){return new b.Vector(a.x-c.x,a.y-c.y)},b.Vector.distance=function(a,c){var d=b.Vector.minus(a,c);return d.length()},b.Vector.multiple=function(a,b){return a.x*b.x+a.y*b.y},b.Vector.multipleScalar=function(a,b){var c=a.clone();return c.multiScalar(b),c},b.Vector.multipleVector=function(a,b){return a.x*b.y-a.y*b.x},b.Vector.angleBetween=function(a,b){return a.normalize(),b.normalize(),Math.acos(Vector.multiple(a,b))},b.Vector.getNormalPoint=function(a,c,d){var e=d.between(a),f=c.between(e);return f.normalize(),f.multiScalar(f.multiple(e)),b.Vector.add(e,f)},b.Vector.pointOnLine=function(a,c,d){var e=c.between(a),f=d.between(a),g=0==b.Vector.multipleVector(f,e);return g&&(a.x<d.x&&d.x<c.x||c.x<d.x&&d.x<a.x)},b.Vector.zero=function(){return new b.Vector},b.Vector.random=function(a,c){var d=b.Random(0,a),e=b.Random(0,c);return new b.Vector(d,e)},b.AlgorithmRunner=function(a,c){this.config=a,this.context=c,this.$injector=new b.Injector},b.AlgorithmRunner.prototype.setContext=function(a){this.context=a},b.AlgorithmRunner.prototype.setConfig=function(a){this.config=a},b.AlgorithmRunner.prototype.setInjector=function(a){this.$injector.extend(a)},b.AlgorithmRunner.prototype.constructor=b.AlgorithmRunner,b.AlgorithmRunner.prototype.run=function(){var a=new b.Vector(0,0);for(var c in this.config.algo){var d=this.config.algo[c],e=this.runAlgo(d);(void 0!=e||null!=e)&&a.add(e)}return a},b.AlgorithmRunner.prototype.runAlgo=function(a){for(var b in this.context)this.$injector.register(b,this.context[b]);var c=a.params;for(b in c)this.$injector.register(b,c[b]);return this.$injector.resolve(this.$injector.get(a.name),this.$injector)},b.EventHandler=function(){this.event=null,this.algoRunner=null,this.handler={},this.$injector=new b.Injector},b.EventHandler.prototype.constructor=b.EventHandler,b.EventHandler.prototype.addAlgoRunner=function(a){this.algoRunner=a},b.EventHandler.prototype.fire=function(a,b){this.event=a;var c=this.handler[this.event]||null;return null==c?(console.log("Event handler for "+this.event+" is empty"),null):(this.algoRunner.setConfig(c),this.algoRunner.setContext(b),this.algoRunner.run())},b.EventHandler.prototype.on=function(a,b){this.handler[a]=b},b.Module=function(a,c){this.name=a,this.$injector=c,this.$handler=new b.EventHandler,this.$injector.register("$handler",this.$handler),this.isBoot=!1},b.Module.prototype.constructor=b.Module,b.Module.prototype.constant=function(a,c){if(this.isBoot)throw new Error("Module "+a+" already initialized");if(b.isFunction(c))throw new Error("Constant"+a+" couldn't be a function");return this.$injector.registerConstant(a,c),this},b.Module.prototype.algorithm=function(){if(this.isBoot)throw new Error("Module "+a+" already initialized");var a=arguments[0],c=null;if(b.isString(a)){if(2!=arguments.length)throw new Error("Cannot find "+a+" implementation");if(c=arguments[1],b.isArray(c)){var d=b.getDependencies(c);c=c[c.length-1],c.$inject=d}this.$injector.register(a,c)}return this},b.Module.prototype.service=function(a,c){if(this.isBoot)throw new Error("Module "+a+" already initialized");return b.contains(a,b.servicePrefix)||(a+=b.servicePrefix),this.$injector.registerService(a,c),this},b.Module.prototype.handlerConfig=function(){if(this.isBoot)throw new Error("Module "+name+" already initialized");if(void 0==arguments||null==arguments)throw new Error("Config event handler function is empty");return this.$injector.resolve(arguments[0],this),this},b.Module.prototype.handler=function(){return this.$handler},b.Module.prototype.run=function(a){return this.$injector.resolve(a)},b.Module.prototype.value=function(a,c){if(this.isBoot)throw new Error("Module "+a+" already initialized");if(b.isFunction())throw new Error("Value"+a+" couldn't be a function");return this.$injector.register(a,c),this},b.Module.prototype.boot=function(){this.$runner=new b.AlgorithmRunner,this.$runner.setInjector(this.$injector),this.$handler.addAlgoRunner(this.$runner),this.$injector.register("$handler",this.$handler),this.isBoot=!0},b.$globalInjector=new b.Injector,b.module=function(a,c){if(!b.$globalInjector.canResolve(a)&&void 0!=c&&b.isArray(c)){for(var d=new b.Injector,e=0;e<c.length;e++){if(!b.$globalInjector.canResolve(c[e]))throw new Error("Cant resolve "+c[e]+" dependency");var f,g=b.$globalInjector.get(c[e]);for(f in g.$injector.dependencies)d.register(f,g.$injector.dependencies[f]);for(f in g.$injector.services)d.registerService(f,g.$injector.services[f])}for(var h=new b.Module(a,d),e=0;e<c.length;e++){if(!b.$globalInjector.canResolve(c[e]))throw new Error("Cant resolve "+c[e]+" dependency");var g=b.$globalInjector.get(c[e]);h.$handler.handler=b.extend(g.$handler.handler)}return b.$globalInjector.register(a,h),h}if(b.$globalInjector.canResolve(a)&&void 0==c)return b.$globalInjector.get(a);throw new Error("Can't create module"+a+" cause dependency array is empty")},b.register=function(a,c){b.$globalInjector.register(a,c)},a.steerjs=b}).call(this);